workflows:
  dia_guest_register_workflow:
    name: DIA Guest & Members Register Build
    max_build_duration: 60
    instance_type: mac_mini_m1

    environment:
      flutter: stable
      xcode: latest
      cocoapods: default
      vars:
        PROJECT_ZIP: "dia_guest_register_codermagic_ready.zip"

    scripts:
      - name: Unzip project
        script: |
          echo "üì¶ Extracting Flutter project..."
          cd $CM_BUILD_DIR
          unzip -o $PROJECT_ZIP -d project_root
          cd project_root
          PROJECT_DIR=$(find . -maxdepth 2 -type f -name "pubspec.yaml" -exec dirname {} \;)
          echo $PROJECT_DIR > /tmp/flutter_project_path.txt

      - name: Install Flutter dependencies
        script: |
          echo "üì¶ Installing Flutter dependencies..."
          PROJECT_DIR=$(cat /tmp/flutter_project_path.txt)
          cd $CM_BUILD_DIR/project_root/$PROJECT_DIR
          flutter pub get

      - name: Build Android release APK
        script: |
          echo "üèóÔ∏è Building DIA Guest & Members Register release APK..."
          PROJECT_DIR=$(cat /tmp/flutter_project_path.txt)
          cd $CM_BUILD_DIR/project_root/$PROJECT_DIR
          flutter build apk --release
          mkdir -p $CM_BUILD_DIR/build_outputs
          cp build/app/outputs/flutter-apk/app-release.apk \
             $CM_BUILD_DIR/build_outputs/DIA_Guest_Register_v1.0.apk

    artifacts:
      - build_outputs/**/*.apk

    publishing:
      email:
        recipients:
          - your-email@example.com  # Replace with your actual email



